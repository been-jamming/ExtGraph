/******************************************************************************
*
* project name:    ExtGraph
* file name:       unpack.c (originally part of the TIGCC Tools Suite)
* initial date:    24/02/2002 (integrated into ExtGraph)
* authors:         albert@cs.tut.fi
*                  b.denis@libertysurf.fr
*                  thomas.nussbaumer@gmx.net
*                  samuel@nyall.net
*                  greg@gregd.org
*                  lionel_debroux@yahoo.fr
*
*
* description:     unpack routine to exepack compression
*
* -----------------------------------------------------------------------------
*
* based on code from Pasi 'Albert' Ojala, albert@cs.tut.fi
* heavily reduced to fit to the needs by thomas.nussbaumer@gmx.net
* assembler optimizations by b.denis@libertysurf.fr
*
* for details on the used algorithm see:
*
* http://www.cs.tut.fi/~albert/Dev/pucrunch/index.html
*
* -----------------------------------------------------------------------------
* Liscense of the decompression routines, starting from 2.00 Beta 4:
*
*   The liscense is quite similar to that of the origional version in c.
*
*   The code may be freely used in any non commercial application.  If
*   you do use it please give credit to tict (http://tict.ticalc.org) and
*   myself (Samuel Stearley).  I state this as a request but it is actually
*   not.
*
*   The author(s) (Samuel/Tict/Any other contributor) make no
*   representations or warranties about the suitability of the software,
*   either express or implied. The author(s) shall not be liable for
*   any damages suffered as a result of using or distributing this
*   software.
*
*   If you distribute this file on a website or as part of
*   the source of a project do not remove the liscense from this file.

******************************************************************************/

// FAST VERSION (~80 KB/sec).
// DOES NOT MESS UP GRAYSCALE (INT1 NOT DISABLED).
#define _unpack_decompress_ ((__attribute__((__stkparm__)) unsigned short(*)(unsigned char*,unsigned char*))(unsigned short[]){\
0x48e7,0x1f3e,0x2c6f,0x002c,0x2a6f,0x0030,0x47ee,0x000f,0x7a00,0x1a2e,\
0x0006,0x3e3c,0x0080,0x7004,0x0c2e,0x0054,0x0002,0x666c,0x0c2e,0x0050,\
0x0003,0x6664,0x7808,0x7006,0xb82e,0x000a,0x665a,0x0c2e,0x0080,0x000b,\
0x6652,0x7007,0x7200,0x122e,0x0009,0x2841,0x5141,0x6444,0x7005,0x7200,\
0x122e,0x000c,0x2241,0x5b41,0x6e36,0x984c,0xc98c,0x7000,0x1013,0x4df6,\
0x0010,0x4fef,0xfefc,0x244f,0x421a,0x7000,0x7207,0x7400,0x01c2,0x5342,\
0x14c0,0x51ca,0xfffc,0x5240,0x51c9,0xfff0,0x244f,0x1c1e,0x601c,0x7000,\
0x4fef,0x0104,0x4400,0x4cdf,0x7cf8,0x4e75,0x320c,0xe838,0x1600,0x6100,\
0x0158,0x8600,0x1ac3,0x3204,0x6708,0x6100,0x014c,0xb005,0x66e6,0x6100,\
0x00fc,0x3600,0x5340,0x6740,0x6100,0x00f2,0x5200,0x67c6,0x5500,0x3209,\
0x670a,0xe368,0x2040,0x6100,0x0128,0xd048,0x7400,0x1f00,0x341f,0x1f06,\
0x301f,0x1c1e,0x1006,0x1232,0x7000,0x5201,0xe268,0x1400,0x4602,0x4682,\
0x41f5,0x2800,0x1ad8,0x51cb,0xfffc,0x60aa,0x1007,0xc006,0x671e,0xe21f,\
0x6402,0x1c1e,0x1007,0xc006,0x6638,0xe21f,0x6402,0x1c1e,0x3204,0x6100,\
0x00e0,0xc145,0x6000,0xff7a,0xe21f,0x6402,0x1c1e,0x1f06,0x321f,0x1c1e,\
0x1206,0x1032,0x7000,0x5240,0xe069,0x74ff,0x1401,0x41f5,0x2800,0x1ad8,\
0x1ad8,0x6000,0xff62,0xe21f,0x6402,0x1c1e,0x6162,0x1600,0x6a1a,0xd603,\
0x1007,0xc006,0x56c0,0x9600,0xe21f,0x6402,0x1c1e,0x614c,0x5300,0x3f03,\
0x1e80,0x361f,0x6142,0x0c00,0x0020,0x6406,0x1033,0x0000,0x602c,0xe708,\
0x1206,0x1432,0x7000,0xe61f,0x5502,0x6412,0x1c16,0xdc06,0xd301,0x5202,\
0x6704,0xdc06,0xd301,0x1c1e,0x6006,0x6602,0x1c1e,0xe429,0x0201,0x0007,\
0x8001,0x1ac0,0x51cb,0xfffc,0x6000,0xfef8,0x3407,0x1006,0xc400,0x6738,\
0xd402,0x5302,0x1232,0x7000,0xc002,0xb102,0x6606,0x1416,0x4602,0x5001,\
0x9232,0x2000,0x1401,0x5202,0x0c01,0x0007,0x6504,0x7207,0x7407,0x3007,\
0xe43f,0xbe00,0x6502,0x1c1e,0x610e,0x5201,0x03c0,0x4e75,0x7001,0xe21f,\
0x652a,0x4e75,0x7000,0x5301,0x6524,0x6736,0x3007,0xe23f,0xbe00,0x651c,\
0xd040,0x5340,0xc006,0x1f00,0x301f,0x1c1e,0x1006,0x1432,0x7000,0xe468,\
0xe21f,0x6402,0x1c1e,0x4e75,0xd040,0x5340,0xc006,0x1432,0x7000,0xe428,\
0xe21f,0x65ec,0x4e75,0x1006,0xc007,0x56c0,0x4400,0xe21f,0x65de,0x4e75\
})

// SMALL VERSION (~20 KB/sec).
// DOES NOT MESS UP GRAYSCALE (INT1 NOT DISABLED).
#define _unpack_decompress_small_ ((__attribute__((__stkparm__)) unsigned short(*)(unsigned char*,unsigned char*))(unsigned short[]){\
0x48e7,0x1f3e,0x2c6f,0x002c,0x2a6f,0x0030,0x47ee,0x000f,0x1a2e,0x0006,\
0x7e80,0x7004,0x548e,0x0c1e,0x0054,0x662c,0x0c16,0x0050,0x6626,0x7208,\
0x7007,0x5c8e,0x181e,0xb801,0x641a,0x7006,0xb21e,0x6614,0xbe1e,0x6610,\
0x1213,0x43f3,0x1001,0x1c19,0x7005,0x0c16,0x0005,0x6516,0x4400,0x4cdf,\
0x7cf8,0x4e75,0x1204,0x613c,0xc145,0x7208,0x9204,0x613a,0x1ac0,0x1204,\
0x6706,0x612c,0xb005,0x66ee,0x6132,0x3600,0x5340,0x673c,0x612a,0x5200,\
0x67d2,0x5500,0x122b,0xfffd,0x6118,0x7207,0x6112,0x4600,0x4480,0x1af5,\
0x08ff,0x51cb,0xfffa,0x60ce,0x7000,0x6002,0x6148,0x5301,0x6afa,0x4e75,\
0x7206,0x613e,0x54c9,0xfffc,0x4441,0x5c41,0x7001,0x60ea,0x6130,0x64ce,\
0x612c,0x649c,0x61e6,0x1600,0x6a0c,0x6122,0x3f00,0x61dc,0x5300,0x1e80,\
0x361f,0x61d4,0x0c00,0x0020,0x6406,0x1033,0x0000,0x6004,0x7202,0x61bc,\
0x1ac0,0x7000,0x60ac,0xdc06,0xd140,0xe21f,0x6402,0x1c19,0x44c0,0x4e75\
})


// wrappers for exepack unpacking functions
short __attribute__((__stkparm__)) UnpackBuffer(unsigned char *src, unsigned char *dest) {
    return _unpack_decompress_(src,dest);
}

short __attribute__((__stkparm__)) UnpackBufferSmall(unsigned char *src, unsigned char *dest) {
    return _unpack_decompress_small_(src,dest);
}

// The unpacking functions do not disable interrupts anymore, you have to
// do it explicitely if you want decompression to be ~10% faster:
// OSSetSR(0x0200);
// // decompress
// OSSetSR(0x0000);
// or the slightly more optimized ASM way (using trap #1).
#define UnpackBufferGray UnpackBuffer
